<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>StudyForge — Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body
    class="min-h-screen bg-slate-900 flex items-center justify-center relative overflow-hidden font-[Inter,sans-serif]"
  >
    <!-- Fondos degradados -->
    <div aria-hidden="true" class="absolute inset-0">
      <div
        class="absolute -top-32 -left-20 h-[42rem] w-[42rem] rounded-full bg-gradient-to-br from-pink-400 via-fuchsia-500 to-purple-600 opacity-70 blur-3xl"
      ></div>
      <div
        class="absolute -bottom-32 -right-24 h-[36rem] w-[36rem] rounded-full bg-gradient-to-br from-indigo-500 to-blue-400 opacity-70 blur-3xl"
      ></div>
      <div
        class="absolute -bottom-10 -left-10 h-[24rem] w-[24rem] rounded-full bg-gradient-to-br from-orange-300 to-rose-400 opacity-60 blur-3xl"
      ></div>
    </div>

    <!-- Contenedor principal -->
    <div
      class="relative w-full max-w-md bg-white/95 backdrop-blur rounded-2xl shadow-xl ring-1 ring-black/5 p-8"
    >
      <h1 class="text-3xl font-extrabold text-slate-900">Iniciar sesión</h1>
      <p class="mt-2 text-slate-600">
        Accede a tu cuenta o
        <a
          href="/src/pages/signup.html"
          class="text-fuchsia-600 hover:underline"
          >crea una nueva</a
        >.
      </p>

      <!-- Formulario -->
      <form id="loginForm" class="mt-8 space-y-5" novalidate>
        <!-- Email -->
        <div>
          <label
            for="email"
            class="block text-sm font-medium text-slate-700"
            >Correo electrónico</label
          >
          <input
            id="email"
            type="email"
            required
            placeholder="ejemplo@mail.com"
            class="mt-2 w-full rounded-xl border border-slate-200 px-4 py-3 text-slate-900 placeholder:text-slate-400 shadow-sm focus:border-fuchsia-500 focus:ring-4 focus:ring-fuchsia-500/20"
          />
          <p id="email-error" class="hidden mt-1 text-sm text-rose-600"></p>
        </div>

        <!-- Password -->
        <div>
          <label
            for="password"
            class="block text-sm font-medium text-slate-700"
            >Contraseña</label
          >
          <input
            id="password"
            type="password"
            required
            placeholder="••••••••"
            class="mt-2 w-full rounded-xl border border-slate-200 px-4 py-3 text-slate-900 placeholder:text-slate-400 shadow-sm focus:border-fuchsia-500 focus:ring-4 focus:ring-fuchsia-500/20"
          />
          <p id="pass-error" class="hidden mt-1 text-sm text-rose-600"></p>
        </div>

        <!-- Opciones -->
        <div class="flex items-center justify-between">
          <label class="flex items-center gap-2 text-sm text-slate-700">
            <input
              type="checkbox"
              checked
              class="h-4 w-4 rounded border-slate-300 text-fuchsia-600 focus:ring-fuchsia-500"
            />
            Recordarme
          </label>
          <a
            href="/src/pages/forgot-password.html"
            class="text-sm font-medium text-fuchsia-600 hover:underline"
            >¿Olvidaste tu contraseña?</a
          >
        </div>

        <!-- Botón -->
        <button
          id="loginBtn"
          type="submit"
          class="w-full rounded-full bg-gradient-to-r from-fuchsia-600 to-violet-600 px-6 py-3.5 text-base font-semibold text-white shadow-lg shadow-fuchsia-600/20 transition hover:opacity-95 focus:outline-none focus-visible:ring-4 focus-visible:ring-fuchsia-500/30"
        >
          <span id="btnText">Iniciar sesión</span>
          <span
            id="btnSpinner"
            class="hidden ml-2 inline-block h-5 w-5 animate-spin rounded-full border-2 border-white/60 border-t-white"
          ></span>
        </button>

        <!-- Aviso -->
        <p class="text-center text-xs text-slate-500">
          Al iniciar sesión aceptas nuestros términos de servicio y política de
          privacidad.
        </p>
      </form>
    </div>

    <!-- Toast -->
    <div
      id="toast"
      class="pointer-events-none fixed bottom-4 left-1/2 z-50 hidden -translate-x-1/2 rounded-xl bg-slate-900/90 px-4 py-3 text-sm text-white shadow-lg"
    >
      <span id="toastMsg"></span>
    </div>

    <script>
      const AUTH_URL = "http://localhost:8000/auth/login"; // cambia si tu backend usa otra ruta
      const REDIRECT_URL = "/src/pages/uploaddocuments.html"; // página de subida

      const form = document.getElementById("loginForm");
      const email = document.getElementById("email");
      const pass = document.getElementById("password");

      const emailErr = document.getElementById("email-error");
      const passErr = document.getElementById("pass-error");

      const btn = document.getElementById("loginBtn");
      const btnText = document.getElementById("btnText");
      const spinner = document.getElementById("btnSpinner");

      const toast = document.getElementById("toast");
      const toastMsg = document.getElementById("toastMsg");

      function showToast(msg, ms = 2500) {
        toastMsg.textContent = msg;
        toast.classList.remove("hidden");
        setTimeout(() => toast.classList.add("hidden"), ms);
      }

      function validate() {
        let valid = true;
        emailErr.classList.add("hidden");
        passErr.classList.add("hidden");

        if (!email.value.includes("@")) {
          emailErr.textContent = "Ingresa un correo válido.";
          emailErr.classList.remove("hidden");
          valid = false;
        }

        if (pass.value.trim().length < 6) {
          passErr.textContent = "La contraseña debe tener al menos 6 caracteres.";
          passErr.classList.remove("hidden");
          valid = false;
        }

        return valid;
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        if (!validate()) return;

        btn.disabled = true;
        btnText.textContent = "Iniciando...";
        spinner.classList.remove("hidden");

        const payload = {
          email: email.value.trim(),
          password: pass.value,
        };

        try {
          const res = await fetch(AUTH_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const ok = res.status === 200;
          let data = null;
          try {
            data = await res.json();
          } catch (_) {}

          if (ok) {
            if (data?.token) {
              localStorage.setItem("sf_token", data.token);
            }
            showToast("Inicio de sesión exitoso. Redirigiendo...");
            setTimeout(() => (window.location.href = REDIRECT_URL), 800);
          } else if (res.status === 401) {
            showToast("Correo o contraseña incorrectos.");
          } else {
            showToast("Error al iniciar sesión. Intenta de nuevo.");
          }
        } catch (err) {
          console.error(err);
          showToast("No se pudo conectar al servidor.");
        } finally {
          btn.disabled = false;
          btnText.textContent = "Iniciar sesión";
          spinner.classList.add("hidden");
        }
      });
    </script>
  </body>
</html>
